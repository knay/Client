{% extends "::baseAffichage.html.twig" %}

{% block title_page %}
Facture
{% endblock %}

{% block title %}
ALBA - Facture
{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('bundles/imerirvente/css/cssFacture.css') }}"/> 
{% endblock %}

{% block title_ajout %}Facture{% endblock %}

{% block ajout %}

	{% set variable_de_boucle = 0 %}
	{% set montant_total = 0 %}
	{% set prix_de_la_tva = 0 %}
	{% set montant_avec_tva = 0 %}
	{% set tva = 20 %}
	
	<div class="feuille_facture">
		<div id="logo_facture">
			<h1>Logo - les caprices de lili</h1>
		</div>
		<div id="information">
			<div id="information_facture">Facture n&deg;
			{% if detail_facture_test is defined %}
				{% if detail_facture_test != '' %}
					{% for i in detail_facture_test %}
						{% if variable_de_boucle == 0 %}
							{{ i.numero_facture }}<br>
							<div id="detail_sur_client">
								Le : {{ i.date_facture }}<br>
								Client : {{ i.nom_client }}<br>
								Adresse : <br>
							</div>
							{% set variable_de_boucle = variable_de_boucle + 1 %}
						{% endif %}
					{% endfor %}
				{% endif %}
			{% endif %}
			</div>
			<div id="information_entreprise">3, rue Voltaire<br>66000 Perpignan, France<br>04.68.57.33.26<br></div>
		</div>
		<div id="tableau_facture">
			<table id="tableau_detail_facture" >
				<tr>
					<th class="col_article">Article</th>
					<th>Quantit&eacute</th>
					<th>Prix Unitaire</th>
					<th>Reduction</th>
					<th>Montant</th>
				</tr>
			{% if detail_facture_test is defined %}
				{% if detail_facture_test != '' %}
					{% for i in detail_facture_test %}
						<tr>
			{# 				<label>numero : </label><p>{{ i.numero_facture }}</p>#}
			{# 				<label>date : </label><p>{{ i.date_facture }}</p>#}
			{# 				<label>client : </label><p>{{ i.nom_client }}</p>#}
							<td class="col_article_contenu">{{ i.nom_article }}</td>
							<td>{{ i.nombre_article }}</td>
							<td>{{ i.prix_article }}</td>
							<td>{{ i.reduction_article }}</td>
							<td>{{ i.montant_facture }}</td>
							{% set montant_total =  montant_total +  i.montant_facture %}
						</tr>
					{% endfor %}
				{% else %}
				{% endif %}
			{% else %}
			{% endif %}
				<tr><td></td><td></td><td></td><td></td><td></td></tr>
				
				{% set prix_de_la_tva = (montant_total*tva)/100 %}
				{% set montant_avec_tva = montant_total + prix_de_la_tva %}
				
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td class="tva">Dont TVA &agrave; 20,00%</td>
					<td>{{ prix_de_la_tva|round(2, 'common') }}</td>
				</tr>
				
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td class="tva">TOTAL H.T</td>
					<td>{{ montant_total|round(2, 'common') }}</td>
				</tr>
			</table>
		</div>
		<div id="bas_de_page_facture">
			Siret n&deg;514 862 275 00013 - RCS Perpignan - Code Ape 4771Z<br>
			N&deg; de TVA Intracommunautaire : FR62 514 862 275
		</div>
	</div>
{% endblock %}

{% block recherche %}
	<form method="post" action="{{ path('imerir_vente_facture') }}">
		<label>Date : </label><input type="text" id="date_de_recherche_facture" name="date" size="20" value="aaaa-mm-jj">
		<i id="bouton_supprimer_date" class="fa supprimer fa-minus-square"></i>
		<label>Client : </label><input type="text" id="recherche_client" name="client" size="20">
		<i id="bouton_supprimer_client" class="fa supprimer fa-minus-square"></i>
	<input type="submit">
	</form>
{% endblock %}

{% block table %}
    <tr>
    	<th>N&deg;</th>
    	<th>Date</th>
    	<th>Client</th>
    	<th>Montant</th>
    </tr>
    
    {% for i in result_facture %}
        <tr class="select_ligne">
        	<td>
        		<form method="post" action="{{ path('imerir_vente_facture_detail') }}" >
	        		<input type="hidden" name="ligne_numero" value="{{ i.numero }}">
    			</form>
    		{{ i.numero }}
        	</td>
        	<td>{{ i.date }}</td>
            <td>{{ i.client }}</td>
            <td>{{ i.montant }}</td>
		</tr>
		
    {% endfor %}
{% endblock %}

{% block javascripts %}
<link rel="stylesheet" href="{{ asset('../vendor/components/jqueryui/themes/smoothness/jquery-ui.css') }}"/>
<script>
var format_affichage_date = "yy-mm-dd";
var explication_client = "Nom";
$("#bouton_supprimer_date").hide();
// $("#fieldset_ajout").hide();
$("#bouton_supprimer_client").hide();
$("#date_de_recherche_facture").val('aaaa-mm-jj');
$("#recherche_client").val(explication_client);

//Permet de parametrer le datepicker
$(function() {
    $( "#date_de_recherche_facture" ).datepicker();
	$( "#date_de_recherche_facture" ).datepicker( "option", "showAnim", "slideDown" );
	$( "#date_de_recherche_facture" ).datepicker( "option", "dateFormat", format_affichage_date );
});


//Afficher l'icone de suppression lorsqu'une date est inscrite
$("#date_de_recherche_facture").change(function(){
	$("#bouton_supprimer_date").css("display","inline");
});

//Permet de gerer l'evenement du bouton de suppresion  de la date
$("#bouton_supprimer_date").click(function(){
	$( "#date_de_recherche_facture" ).val('aaaa-mm-jj');
	$("#bouton_supprimer_date").hide();
});

//Affiche l'icone de suppresion lorsque l'utilisateur saisie la recherche d'un client
$("#recherche_client").change(function(){
	$("#bouton_supprimer_client").show();
});

//Permet de gerer l'evenement sur le bouton de suppresion de la recherche client
$("#bouton_supprimer_client").click(function(){
	$("#bouton_supprimer_client").hide();
	$("#recherche_client").val(explication_client);
});

//Permet d'effacer la valeur du champ si elle est egal a nom, donc quand on click pour la premeir fois sur le input
$("#recherche_client").click(function(){
	if ($("#recherche_client").val() == explication_client){
		$("#recherche_client").val('');
	}
});

//Permet de gerer lorsque l'utilisateur click sur une ligne du tableau
$(".select_ligne").click( function(){
	$(this).find('form').submit();
});

//Permet de gerer la langue du datepicker
(function( factory ) {
	if ( typeof define === "function" && define.amd ) {

		define([ "../jquery.ui.datepicker" ], factory );
	} else {
		factory( jQuery.datepicker );
	}
	
}(function( datepicker ) {
	datepicker.regional['fr'] = {
		closeText: 'Fermer',
		prevText: 'Pr&eacutec&eacutedent',
		nextText: 'Suivant',
		currentText: 'Aujourd\'hui',
		monthNames: ['janvier', 'f&eacutevrier', 'mars', 'avril', 'mai', 'juin',
			'juillet', 'ao&ucirct', 'septembre', 'octobre', 'novembre', 'd&eacutecembre'],
		monthNamesShort: ['janv.', 'fï¿½vr.', 'mars', 'avril', 'mai', 'juin',
			'juil.', 'ao&ucirct', 'sept.', 'oct.', 'nov.', 'd&eacutec.'],
		dayNames: ['dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'],
		dayNamesShort: ['dim.', 'lun.', 'mar.', 'mer.', 'jeu.', 'ven.', 'sam.'],
		dayNamesMin: ['D','L','M','M','J','V','S'],
		weekHeader: 'Sem.',
		dateFormat: 'yy-mm-dd',
		firstDay: 1,
		isRTL: false,
		showMonthAfterYear: false,
		yearSuffix: ''};
	datepicker.setDefaults(datepicker.regional['fr']);

	return datepicker.regional['fr'];

}));
//
</script>
{% endblock %}

